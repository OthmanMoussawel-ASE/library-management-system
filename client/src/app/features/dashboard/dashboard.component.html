<div class="dashboard">
  <header class="dashboard-header">
    <h1>Welcome, {{ currentUserName }}</h1>
    <p class="subtitle">Here's what's happening at your library today</p>
  </header>

  <!-- Stats Cards -->
  <section class="stats-section">
    @if (isLoadingStats) {
      <div class="stats-loading">
        <mat-spinner diameter="48"></mat-spinner>
        <span>Loading statistics...</span>
      </div>
    } @else if (stats) {
      <div class="stats-grid">
        <mat-card class="stat-card stat-books">
          <mat-card-content>
            <mat-icon>menu_book</mat-icon>
            <div class="stat-content">
              <span class="stat-value">{{ stats.totalBooks }}</span>
              <span class="stat-label">Total Books</span>
            </div>
          </mat-card-content>
        </mat-card>
        <mat-card class="stat-card stat-available">
          <mat-card-content>
            <mat-icon>check_circle</mat-icon>
            <div class="stat-content">
              <span class="stat-value">{{ stats.availableBooks }}</span>
              <span class="stat-label">Available</span>
            </div>
          </mat-card-content>
        </mat-card>
        <mat-card class="stat-card stat-authors">
          <mat-card-content>
            <mat-icon>person</mat-icon>
            <div class="stat-content">
              <span class="stat-value">{{ stats.totalAuthors }}</span>
              <span class="stat-label">Authors</span>
            </div>
          </mat-card-content>
        </mat-card>
        <mat-card class="stat-card stat-checkouts">
          <mat-card-content>
            <mat-icon>bookmark</mat-icon>
            <div class="stat-content">
              <span class="stat-value">{{ stats.activeCheckouts }}</span>
              <span class="stat-label">{{ isStaff ? 'Active Checkouts' : 'My Checkouts' }}</span>
            </div>
          </mat-card-content>
        </mat-card>
        <mat-card class="stat-card stat-overdue">
          <mat-card-content>
            <mat-icon>warning</mat-icon>
            <div class="stat-content">
              <span class="stat-value">{{ stats.overdueCheckouts }}</span>
              <span class="stat-label">{{ isStaff ? 'Overdue' : 'My Overdue' }}</span>
            </div>
          </mat-card-content>
        </mat-card>
        @if (isStaff) {
          <mat-card class="stat-card stat-patrons">
            <mat-card-content>
              <mat-icon>people</mat-icon>
              <div class="stat-content">
                <span class="stat-value">{{ stats.totalPatrons }}</span>
                <span class="stat-label">Patrons</span>
              </div>
            </mat-card-content>
          </mat-card>
        }
      </div>
    }
  </section>

  <div class="content-grid">
    <!-- AI Recommendations -->
    @if (aiAvailable) {
      <mat-card class="section-card recommendations-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>auto_awesome</mat-icon>
            AI Recommendations — From Your Library
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          @if (isLoadingRecommendations) {
            <div class="recommendations-loading">
              <mat-spinner diameter="32"></mat-spinner>
              <span>Getting recommendations...</span>
            </div>
          } @else if (libraryRecommendations.length > 0) {
            <mat-nav-list>
              @for (rec of libraryRecommendations; track rec.id) {
                <a mat-list-item [routerLink]="['/books', rec.id]">
                  <mat-icon matListItemIcon [class.available]="rec.isAvailable" [class.unavailable]="!rec.isAvailable">
                    {{ rec.isAvailable ? 'check_circle' : 'schedule' }}
                  </mat-icon>
                  <span matListItemTitle>{{ rec.title }}</span>
                  <span matListItemLine class="rec-author">by {{ rec.author }}</span>
                </a>
              }
            </mat-nav-list>
          } @else {
            <p class="empty-state">No recommendations from your library yet.</p>
          }
        </mat-card-content>
      </mat-card>

      <!-- Discover More - AI suggestions not in library -->
      @if (discoverMoreRecommendations.length > 0) {
        <mat-card class="section-card discover-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>explore</mat-icon>
              Discover More
            </mat-card-title>
            <span class="card-subtitle">Books you might like (not in library)</span>
          </mat-card-header>
          <mat-card-content>
            <mat-nav-list>
              @for (title of discoverMoreRecommendations; track title) {
                <div mat-list-item class="discover-item">
                  <mat-icon matListItemIcon>lightbulb</mat-icon>
                  <span matListItemTitle>{{ title }}</span>
                  <span matListItemLine class="discover-hint">Suggest to your librarian!</span>
                </div>
              }
            </mat-nav-list>
          </mat-card-content>
        </mat-card>
      }
    }

    <!-- Recent Activity -->
    <mat-card class="section-card activity-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>history</mat-icon>
          Recent Activity
        </mat-card-title>
        <a mat-button color="primary" [routerLink]="['/checkouts']">View All</a>
      </mat-card-header>
      <mat-card-content>
        @if (isLoadingRecent) {
          <div class="activity-loading">
            <mat-spinner diameter="32"></mat-spinner>
            <span>Loading recent checkouts...</span>
          </div>
        } @else if (recentCheckouts.length > 0) {
          <mat-nav-list>
            @for (checkout of recentCheckouts; track checkout.id) {
              <div mat-list-item class="activity-item">
                <mat-icon matListItemIcon>book</mat-icon>
                <div matListItemTitle class="activity-title">{{ checkout.bookTitle }}</div>
                <div matListItemLine class="activity-meta">
                  {{ checkout.patronName }} · {{ formatDate(checkout.checkedOutAt) }}
                  @if (checkout.isOverdue) {
                    <span class="overdue-badge">Overdue</span>
                  }
                </div>
              </div>
            }
          </mat-nav-list>
        } @else {
          <p class="empty-state">No recent checkouts.</p>
        }
      </mat-card-content>
    </mat-card>
  </div>
</div>
